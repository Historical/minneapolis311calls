div.px-2
  #mapid


script(src="/javascripts/leaflet.js")
script(src="/javascripts/jquery-3.1.0.min.js")

block script
  script(type='text/javascript').
    function onEachFeature(feature, layer) {
      if (feature.properties && feature.properties.pop_up_text) {
        layer.bindPopup(feature.properties.pop_up_text);
      }
    };
    var homeMarker = {
        radius: 8,
        fillColor: "#ff7800",
        color: "red",
        fillOpacity: 1,
        strokeOpacity: 0

    };
    var notHomeMarker = {
        radius: 8,
        fillColor: "#0078ff",
        fillOpacity: 1,
        strokeOpacity: 0
    };

    var addr = $("#address span").text().trim()
    console.log(addr)
    console.log(addr)


    var mymap = L.map('mapid').setView([#{results[0][0].Y}, #{results[0][0].X}], 17)

    L.tileLayer('http://a.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(mymap);
    $(document).ready(function(){
      var bbox = mymap.getBounds()
      var bounds_obj = {
        "West": bbox.getWest(),
        "South": bbox.getSouth(),
        "East": bbox.getEast(),
        "North": bbox.getNorth()
      };
      $.getJSON("/map/geojson", bounds_obj, function( data ) {
        var features = data["features"]
        for (i in features) {
          r = features[i]
          if (r["properties"]["link"] == addr) {
            var homesite = features.splice(i, 1)
          }
        }
        var geo = L.geoJson(data, {
          onEachFeature: onEachFeature,
          pointToLayer: function (geoj, latlng) {
            return L.circleMarker(latlng, notHomeMarker)
          }
        })
        geo.addTo(mymap);

        L.geoJson(homesite, {
          onEachFeature: onEachFeature,
          pointToLayer: function (geoj, latlng) {
            return L.circleMarker(latlng, homeMarker)
          }
        }).addTo(mymap);
      });
    });
